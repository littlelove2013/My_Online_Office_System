# My_Online_Office_System
Online office system
# 前言

我一个人在八月份开发了这套捐赠管理系统。因为从头到尾由我一个人写的，所以bug可能会比较多，编程风格也很包含有我的一些习惯，而且我在接受这个任务的时候，并不会javascript等前端开发语言，审美也不是很好，不太会设计前端UI，所以我只是把需要实现的功能用纯php实现了。

因为php是服务器开发语言，也就是说这套系统所有的信息以及操作都会在服务器上处理完成之后再传到客户机，所以对服务器资源占用会比较高，这并不符合我的风格，我希望的是尽量多的计算和复杂的操作在客户机上实现，而服务器上只处理请求和传递保存数据，所以如果行的话，希望有人能把前端写一下。
我会把我写这套程序的架构和思路大体写出来，并且附上我自己写的几个数据库操作类，希望能对后面继续开发的人有所帮助。

# 开发思路
-	首先是数据库的设计思路：以项目和客户还有交往记录为中心，然后在项目和客户之间建立捐赠记录数据库表，建立与项目相关的支出记录表，然后以这5张表为核心，建立需要附加信息的子表，
-	在设计展示页面时，借鉴数据库设计方式，把项目、支出记录、捐赠记录、交往记录作为单独的展示页面分别建立工程，对应的文件夹如1中的文件结构图右上侧部分，然后客户及其他设置表项则同意放在Others文件夹里，便于管理
-	每个文件夹的目录结构：
-->	Projects、donatedFunds、spendFunds、inters的“四层式结构”:
a) index.php唯一入口，限制中途访问出错。

b) loadXxxx.php:通过一次数据库访问，降低数据库访问速度，提高处理速度，如果此处有前端处理，其实就不需要后面两个步骤，可以直接接前端进行处理。

c) dealWithXxxx.php:此文件对过滤参数进行初始值设置，然后接受GET参数，处理从上一步传递的数据，并保存过滤参数，然后把数据传到下一处理页面。

d) showXxxx.php:此函数充当本系统的前端，把获取到的数据，直接通过showPage类显示到前端页面，并接受用户的输入参数，传回后台的dealWithXxxx.php文件处理，再传回前台。（其实我觉的show和dealWith文件才像是C/S模式，一个处理后台，一个处理前端输入，如果能写javascript前端，其实可以不用此模式）

e) insertUpdate文件夹里的内容用于添加和修改以及删除该表的对应条目，对应于网页里的添加、删除和编辑菜单onsXxxxShow文件夹用于展示一个条目的详细内容

--> Tools保存公用的函数和类，包含三个文件两个文件夹：
a)	getMysqlDataFun.php:包含公共的所有函数

b)	showPage.php:分页显示类，用于显示从数据库搜索到的所有条目，按每页多少条进行分页显示

c)	showTable.php:数组显示类，用于显示每一条记录的具体属性

a)	CSS文件夹：包含公共风格文件testTableCss.css

b)	sql文件夹：包含建立数据库的sql语句

--> Others文件夹包含很多关系表和小表的处理以及客户表的处理
a)	index.php是唯一入口，其中index.php中包含菜单结构，其结构大致是按照文件夹的组织方式进行组织的（之所以说大概，是因为我后来又改了一些结构）

b)	网页中每一个菜单的设置都是按照其文件夹来的，所以要修改某一个项目，直接找到对应的文件夹即可

c)	每一层文件夹是对应于数据库上相应的主表附加属性小表构建的，附加的小表因为数据量小而且不经常访问，所以不采用四层式结构(但是客户处理单元（customer文件夹）要采用四层式处理单元以便于进行数据筛选)，而是直接一个php文件，采用每次查询数据库的方式进行数据访问和操作。

- 前端数据展示及筛选：
-- 写了专门用于分页显示的类：showPage类，此类允许输入一个二维数组作为源数据（setData($data)），然后按照一维的数据条目作为显示的数据总条目，逐行显示每一条。
showPage可以外部设置表头显示(setHead($head))以及每页展示条目数(setPagenum($num)),并且支持显示自定义表名(Display($tableName,$url))。
因为有showPage类的存在，我们只需要把函数（这个接下来会讲到，在getMysqlDataFun.php文件中）搜索到的数组，做处理(dealWithXxxx.php)，然后直接赋值给showPage对象的源数据，进行显示(showXxxx.php)。
-- showTable类用于显示一维数组，要求输入一个一维数组的源数据(setData($data))
showTable也可以设置头部显示，但是只能是有两个元素的一维数组(setHead($head)),默认为array(“属性名”,”属性值“);
因为有showTable类的存在，我们只需要对函数（同上）搜索到的具体条目，转换为一维数组（因为搜索出来的条目都是二维数组，搜索具体条目时就只有一条，然后选择该二维数组的第一组元素即可），然后设置为showTable对象的源数据进行显示即可。
-- getMysqlDataFun.php:该文件中包含了所有的共有函数，
包括数据库操作函数：
getTableM($table,$field,$where='')：可带条件的查询函数
insertTableM($table,$data)：数据库插入函数（注意数据格式）
updateTableM($table,$data,$where)：数据库更新函数
deleteTableM($table,$where)：删除数据库某行
二维数组处理函数：
array_sort($array,$keys,$type='asc')：二维数组按指定第二维的键值排序，注意：
	  默认asc为升序，desc为降序，其他命令则忽略不执行此函数
array_select($data,$key,$value)：筛选出一个二维数组中某一个键对应的值
即：如果键值在$key处的值是$value时，则选上，不是则放弃此列值
array_selectUpDown($data,$key,$up,$down)：同上，但是是对一个($down,$up)之间的范围进行筛选，在范围内则取其值，不在范围内则放弃
setTimeToStr(&$data,$key)：将二维数组某一个键所对应的unix时间转换为字符串日期
-- CSS文件夹是风格文件夹，存放公共的风格属性，其中主要是testTableCss.css文件，可以通过修改他完成对整个系统风格的重新设置

# 安装手册

1、确保您有两个压缩包：my_TD_OA.rar、DB.rar
2、确保您已正确安装通道OA2013并已经配置好可以正常登录，然后找到通达oa的安装目录（假设为TD_OA_PATH）
3、将my_TD_OA.rar解压到路径：TD_OA_PATH/webroot/general/
4、执行TD_OA_PATH/webroot/general/my_TD_OA/Tools/sql/2015_8_31_1.sql的sql语句，在mysql里建立数据库
5、将DB.rar解压到路径：TD_OA_PATH/webroot/inc/    
6、配置D_OA_PATH/webroot/inc/BD/conf/conf.php的数据库配置信息
7、至此安装步骤完成，其余步骤请按照《捐赠系统开发文档.docx》进行配置

# 关键文件
- 四层式结构的处理逻辑。我觉得这个应该是还是挺好理解的，只是当数据量大，筛选的条件比较多时，文件会比较大，但是文件结构和思路是异常清晰的，具体请见dealWith及show的php文件
- Tools文件夹里面的共有文件集包含整个系统的基础代码（还有inc/DB文件里的数据库处理代码），所以尽量别动，要动之前，记得备份。

# 不足之处
- 四层式结构的处理方式：我觉得这是纯后端开发该系统的一种前端响应方式，虽然会增加服务器处理负担，但是能确保数据的安全和一致性，每次提供给客户端的，只有显示的那一页的数据，全部数据永远在服务器上，不会出现在客户端上，但是如果网络不佳，或者服务器性能不好而数据量太大，那么响应会出大问题，到时候，希望能改成前后端分开处理得模式
- 希望能够把系统涉及到的所有用于前端的变量，存到一个单独的语言文件里，这样便于以后的语言切换和编码

